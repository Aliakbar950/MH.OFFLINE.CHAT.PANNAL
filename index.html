<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MH ADMIN - PREMIUM KEY MANAGER</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary: #ff0000;
            --primary-dark: #b30000;
            --bg: #050505;
            --card: rgba(13, 13, 13, 0.85);
            --text: #ffffff;
            --glow: 0 0 15px rgba(255, 0, 0, 0.7), 0 0 30px rgba(255, 0, 0, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: url('https://www.transparenttextures.com/patterns/carbon-fibre.png'), linear-gradient(to bottom, #0a0a0a, #000); color: var(--text); overflow-x: hidden; }

        /* Splash Screen */
        #splash { position: fixed; inset: 0; background: radial-gradient(circle, #1a0000 0%, #000 100%); z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; }
        .spin-logo { width: 120px; height: 120px; border-radius: 50%; object-fit: cover; animation: spinLogo 3s linear infinite; filter: drop-shadow(0 0 15px red); }
        @keyframes spinLogo { to { transform: rotate(360deg); } }
        .loading-counter { font-family: 'Orbitron'; font-size: 35px; color: var(--primary); font-weight: 900; margin-top: 20px; text-shadow: var(--glow); }
        .splash-text { font-family: 'Orbitron'; font-size: 20px; color: white; margin-top: 10px; letter-spacing: 3px; animation: pulseText 1.5s infinite alternate; }
        @keyframes pulseText { from { opacity: 0.7; transform: scale(0.95); } to { opacity: 1; transform: scale(1.05); } }

        /* Admin Login Screen */
        .auth-container { height: 100vh; display: none; justify-content: center; align-items: center; }
        .auth-card { background: var(--card); padding: 50px 40px; border-radius: 20px; width: 90%; max-width: 420px; border: 1px solid var(--primary); text-align: center; box-shadow: var(--glow); }

        h1, h2 { font-family: 'Orbitron'; color: var(--primary); text-shadow: var(--glow); }

        input { width: 100%; padding: 15px; margin-bottom: 20px; background: rgba(0,0,0,0.6); border: 1px solid #333; color: white; border-radius: 12px; outline: none; text-align: center; font-family: 'Orbitron'; font-size: 15px; transition: 0.3s; }
        input:focus { border-color: var(--primary); box-shadow: var(--glow); }

        .btn-prime { width: 100%; padding: 15px; background: linear-gradient(45deg, var(--primary-dark), var(--primary)); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-family: 'Orbitron'; font-size: 16px; transition: 0.3s; box-shadow: 0 4px 15px rgba(255,0,0,0.4); }
        .btn-prime:hover { transform: scale(1.05); box-shadow: var(--glow); }

        /* Dashboard */
        #admin-panel { display: none; padding: 30px; max-width: 900px; margin: auto; }
        .header-panel { text-align: center; margin-bottom: 40px; }
        .header-panel img { width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--primary); box-shadow: var(--glow); margin-bottom: 10px; }

        /* Stats Section */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: rgba(255,0,0,0.05); border: 1px solid rgba(255,0,0,0.3); padding: 20px; border-radius: 15px; text-align: center; transition: 0.3s; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: var(--glow); border-color: var(--primary); }
        .stat-card i { font-size: 30px; color: var(--primary); margin-bottom: 10px; }
        .stat-card h3 { font-size: 28px; font-family: 'Orbitron'; margin: 10px 0; color: white; text-shadow: var(--glow); }
        .stat-card p { font-size: 12px; color: #aaa; font-weight: bold; }

        /* Key List Section */
        .panel-box { background: var(--card); padding: 30px; border-radius: 15px; border: 1px solid #333; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .key-list { margin-top: 20px; max-height: 400px; overflow-y: auto; padding-right: 10px; }

        .key-item { background: rgba(0,0,0,0.8); padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-radius: 10px; border-left: 4px solid var(--primary); transition: 0.3s; border-right: 1px solid #222; border-top: 1px solid #222; border-bottom: 1px solid #222; }
        .key-item:hover { background: rgba(255,0,0,0.1); }

        .key-info { display: flex; flex-direction: column; gap: 5px; }
        .the-key { font-family: 'Orbitron'; font-size: 15px; color: var(--primary); font-weight: bold; }
        .the-id { font-size: 12px; color: #bbb; }
        .status-badge { font-size: 10px; padding: 3px 8px; border-radius: 5px; background: #222; color: white; display: inline-block; width: fit-content; }
        .status-badge.used { background: var(--primary); color: white; }

        .delete-btn { color: #ff4444; cursor: pointer; font-size: 20px; transition: 0.3s; background: none; border: none; }
        .delete-btn:hover { color: var(--primary); transform: scale(1.2); text-shadow: var(--glow); }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 10px; }
    </style>
</head>
<body>

    <!-- Splash Screen -->
    <div id="splash">
        <img src="https://i.ibb.co/k228N76Z/MH-HACKS.png" alt="MH Logo" class="spin-logo">
        <div class="loading-counter" id="loading-counter">0%</div>
        <h2 class="splash-text">MH SYSTEM ADMIN</h2>
    </div>

    <!-- Admin Login -->
    <div id="admin-login" class="auth-container">
        <div class="auth-card">
            <h2 style="margin-bottom: 20px;">ADMIN ACCESS</h2>
            <input type="password" id="admin-key" placeholder="Enter Admin Panel Key">
            <button class="btn-prime" onclick="loginAdmin()">LOGIN <i class="fa-solid fa-lock-open"></i></button>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="admin-panel">
        <div class="header-panel">
            <img src="https://i.ibb.co/k228N76Z/MH-HACKS.png" alt="Logo">
            <h1>MH HACKS OFFLINE CHAT PANEL</h1>
            <p style="color: #aaa; margin-top:5px; font-family:'Orbitron';">PREMIUM KEY GENERATOR</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <i class="fa-solid fa-key"></i>
                <h3 id="stat-total">0</h3>
                <p>TOTAL GENERATED KEYS</p>
            </div>
            <div class="stat-card">
                <i class="fa-solid fa-user-check"></i>
                <h3 id="stat-used">0</h3>
                <p>APP USE (ACTIVE USERS)</p>
            </div>
            <div class="stat-card">
                <i class="fa-solid fa-user-xmark"></i>
                <h3 id="stat-unused">0</h3>
                <p>APP NOT USE (UNUSED KEYS)</p>
            </div>
        </div>

        <div class="panel-box">
            <button class="btn-prime" onclick="generateKey()" style="margin-bottom: 20px;"><i class="fa-solid fa-bolt"></i> GENERATE NEW ACCESS KEY</button>
            <h3 style="font-family:'Orbitron'; color:var(--primary); margin-bottom: 10px; border-bottom:1px solid #333; padding-bottom:10px;">KEY DATABASE</h3>
            <div class="key-list" id="key-list">
                <!-- Keys Will Load Here -->
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, remove, get, child } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAp7HD_XEX4Xh9iGMM32f0GyiLNzjZUfUQ",
            authDomain: "toolkit-pannel-1e169.firebaseapp.com",
            databaseURL: "https://toolkit-pannel-1e169-default-rtdb.firebaseio.com",
            projectId: "toolkit-pannel-1e169",
            storageBucket: "toolkit-pannel-1e169.firebasestorage.app",
            messagingSenderId: "195618875929",
            appId: "1:195618875929:web:9b808a567865ce9e031888"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Splash Loader Animation
        window.onload = () => {
            let count = 0;
            const counterElem = document.getElementById('loading-counter');
            let loaderInterval = setInterval(() => {
                count += 2;
                if(count > 100) count = 100;
                counterElem.innerText = count + "%";

                if(count === 100) {
                    clearInterval(loaderInterval);
                    setTimeout(() => {
                        document.getElementById('splash').style.display = 'none';
                        // Check if admin already logged in this session
                        if(sessionStorage.getItem('mh_admin') === 'true') {
                            document.getElementById('admin-panel').style.display = 'block';
                        } else {
                            document.getElementById('admin-login').style.display = 'flex';
                        }
                    }, 500);
                }
            }, 30);
        };

        // Admin Login
        window.loginAdmin = () => {
            const val = document.getElementById('admin-key').value;
            if(val === "MH562100607") {
                sessionStorage.setItem('mh_admin', 'true');
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
            } else {
                alert("ACCESS DENIED: INCORRECT ADMIN KEY!");
            }
        };

        // Generate Random Premium Key
        window.generateKey = () => {
            const newKey = "MH-KEY-" + Math.random().toString(36).substr(2, 8).toUpperCase();
            const newChatID = "MH-" + Math.floor(1000 + Math.random() * 9000);

            set(ref(db, 'keys/' + newKey), {
                chatID: newChatID,
                status: "active"
            });

            set(ref(db, 'ids/' + newChatID), true);
            alert("SUCCESS! New Key Generated: \n" + newKey);
        };

        // Realtime Data Fetching (Stats + Key List)
        onValue(ref(db, 'keys'), async (snapshot) => {
            const list = document.getElementById('key-list');
            list.innerHTML = "";

            let totalKeys = 0;
            let usedKeys = 0;
            let unusedKeys = 0;

            if(snapshot.exists()) {
                const keysData = snapshot.val();
                totalKeys = Object.keys(keysData).length;

                // Fetch Users to verify how many are active
                const usersSnap = await get(child(ref(db), 'users'));
                let usersData = usersSnap.exists() ? usersSnap.val() : {};

                for (let key in keysData) {
                    let kData = keysData[key];
                    let cID = kData.chatID || "N/A";

                    // Check if this chatID exists in Users node (Meaning they logged in and saved profile)
                    let isUsed = false;
                    if(usersData[cID]) {
                        isUsed = true;
                        usedKeys++;
                    } else {
                        unusedKeys++;
                    }

                    const div = document.createElement('div');
                    div.className = 'key-item';
                    div.innerHTML = `
                        <div class="key-info">
                            <span class="the-key"><i class="fa-solid fa-key" style="color:var(--primary); margin-right:5px;"></i> ${key}</span>
                            <span class="the-id"><i class="fa-solid fa-hashtag" style="margin-right:5px;"></i> Chat ID: ${cID}</span>
                            <span class="status-badge ${isUsed ? 'used' : ''}">${isUsed ? 'IN USE (ACTIVE)' : 'UNUSED'}</span>
                        </div>
                        <button class="delete-btn" onclick="deleteKey('${key}', '${cID}')"><i class="fa-solid fa-trash-can"></i></button>
                    `;
                    list.appendChild(div);
                }
            } else {
                list.innerHTML = "<p style='color:#aaa; text-align:center;'>No keys generated yet.</p>";
            }

            // Update Stats Display
            document.getElementById('stat-total').innerText = totalKeys;
            document.getElementById('stat-used').innerText = usedKeys;
            document.getElementById('stat-unused').innerText = unusedKeys;
        });

        window.deleteKey = (key, chatID) => {
            if(confirm("Are you sure you want to permanently delete this key?")) {
                remove(ref(db, 'keys/' + key));
                if(chatID !== "N/A") {
                    remove(ref(db, 'ids/' + chatID));
                    remove(ref(db, 'users/' + chatID)); // Also clean up user profile
                }
            }
        };
    </script>
</body>
</html>
